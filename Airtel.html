<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Accounts Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Firebase -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-app.js";
        import { getFirestore, collection, addDoc, query, where, onSnapshot } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-firestore.js";
        window.initializeApp = initializeApp;
        window.getFirestore = getFirestore;
        window.collection = collection;
        window.addDoc = addDoc;
        window.query = query;
        window.where = where;
        window.onSnapshot = onSnapshot;
    </script>
    <style>
        body {
            background: linear-gradient(135deg, #74ebd5 0%, #ACB6E5 100%);
            min-height: 100vh;
            margin: 0;
            font-family: 'Segoe UI', Arial, sans-serif;
        }
        .dashboard-container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .dashboard-card {
            background: #fff;
            border-radius: 18px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.18);
            padding: 40px 32px 32px 32px;
            width: 420px;
            max-width: 98vw;
        }
        h1 {
            text-align: center;
            margin-bottom: 18px;
            color: #0066cc;
            letter-spacing: 1px;
        }
        form {
            display: flex;
            gap: 10px;
            margin-bottom: 28px;
        }
        input[type="text"] {
            flex: 1;
            padding: 12px 16px;
            border-radius: 8px;
            border: 1px solid #ccc;
            font-size: 1.05rem;
            transition: border 0.2s;
            outline: none;
            background: #f8fbfe;
        }
        input[type="text"]:focus {
            border: 1.5px solid #0066cc;
        }
        button {
            padding: 12px 18px;
            border: none;
            background: linear-gradient(90deg, #0066cc 0%, #00c6ff 100%);
            color: #fff;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,102,204,0.09);
            transition: background 0.19s, transform 0.12s;
            font-size: 1rem;
        }
        button:hover {
            background: linear-gradient(90deg, #005bb5 0%, #0099cc 100%);
            transform: translateY(-2px) scale(1.04);
        }
        h2 {
            margin-top: 10px;
            color: #333;
            font-size: 1.15rem;
            font-weight: 500;
            letter-spacing: 0.5px;
        }
        .card-list {
            display: flex;
            flex-wrap: wrap;
            gap: 22px;
            justify-content: center;
            margin-top: 16px;
        }
        .account-card {
            background: linear-gradient(135deg, #eaf7ff 0%, #f8fbfe 100%);
            border-radius: 15px;
            box-shadow: 0 4px 18px rgba(0,102,204,0.10);
            min-width: 180px;
            max-width: 220px;
            padding: 22px 18px;
            display: flex;
            align-items: center;
            gap: 16px;
            cursor: pointer;
            transition: box-shadow 0.18s, transform 0.16s, background 0.18s;
            position: relative;
            border: 1px solid #e3eaf3;
        }
        .account-card:hover {
            box-shadow: 0 8px 32px rgba(0,102,204,0.14);
            transform: scale(1.04) translateY(-2px);
            background: linear-gradient(135deg, #e0f1fd 0%, #f8fbfe 100%);
            border-color: #74ebd5;
        }
        .card-icon {
            background: linear-gradient(135deg, #74ebd5 0%, #ACB6E5 100%);
            border-radius: 50%;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .card-icon svg {
            width: 26px;
            height: 26px;
            fill: #0066cc;
        }
        .card-info {
            flex: 1;
            text-align: left;
        }
        .card-name {
            font-size: 1.13rem;
            color: #0066cc;
            font-weight: 600;
            margin-bottom: 2px;
            letter-spacing: 0.2px;
        }
        .chevron {
            margin-left: auto;
            display: flex;
            align-items: center;
            color: #74ebd5;
        }
        .chevron svg {
            width: 20px;
            height: 20px;
            fill: #74ebd5;
        }
        .no-accounts {
            color: #888;
            text-align: center;
            margin-top: 20px;
        }
        @media (max-width: 600px) {
            .dashboard-card { padding: 16px 6px; width: 98vw; }
            .account-card { min-width: 98vw; max-width: 98vw; }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <div class="dashboard-card">
            <h1>Accounts Dashboard</h1>
            <form id="accountForm">
                <input type="text" id="name" placeholder="Enter Account Name" required>
                <button type="submit">Create Account</button>
            </form>
            <h2>Accounts</h2>
            <div class="card-list" id="cardList"></div>
            <div class="no-accounts" id="noAccounts"></div>
        </div>
    </div>
    <script type="module">
        // Firestore config
        const firebaseConfig = {
            apiKey: "AIzaSyB-lm7Y3r1F6VvY8PKvY8glLabZDbJsHM1k",
            authDomain: "trismartstores.firebaseapp.com",
            projectId: "trismartstores",
            storageBucket: "trismartstores.appspot.com",
            messagingSenderId: "416692703333",
            appId: "1:416692703333:web:d4b60292621435c748f68c",
            measurementId: "G-NJPQ7L3QWJ"
        };
        const app = window.initializeApp(firebaseConfig);
        const db = window.getFirestore(app);

        const branchId = localStorage.getItem('branchId');
        if (!branchId) {
            alert('Please select a branch from the dashboard first.');
            window.location.href = 'dashboard.html';
        }

        function renderAccountsRealtime() {
            const cardList = document.getElementById("cardList");
            const noAccounts = document.getElementById("noAccounts");
            const q = window.query(
                window.collection(db, "accounts"),
                window.where("branchId", "==", branchId)
            );
            window.onSnapshot(q, (snapshot) => {
                cardList.innerHTML = "";
                if (snapshot.empty) {
                    noAccounts.textContent = "No accounts created yet.";
                } else {
                    noAccounts.textContent = "";
                    snapshot.forEach(doc => {
                        const data = doc.data();
                        const card = document.createElement("div");
                        card.className = "account-card";
                        card.onclick = () => {
                            window.location.href = `accounts.html?id=${encodeURIComponent(doc.id)}`;
                        };
                        card.innerHTML = `
                            <div class="card-icon">
                                <svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                            </div>
                            <div class="card-info">
                                <div class="card-name">${data.name}</div>
                            </div>
                            <div class="chevron">
                                <svg viewBox="0 0 24 24"><path d="M9.29 6.71a1 1 0 0 1 1.42 0l5 5a1 1 0 0 1 0 1.42l-5 5a1 1 0 0 1-1.42-1.42L13.59 12 9.29 7.71a1 1 0 0 1 0-1.42z"></path></svg>
                            </div>
                        `;
                        cardList.appendChild(card);
                    });
                }
            });
        }

        document.getElementById("accountForm").addEventListener("submit", async function(e) {
            e.preventDefault();
            const nameInput = document.getElementById("name");
            const name = nameInput.value.trim();
            if (name) {
                try {
                    await window.addDoc(window.collection(db, "accounts"), {
                        name,
                        branchId,
                        created: new Date().toISOString()
                    });
                } catch (err) {
                    alert("Error creating account: " + err.message);
                }
                nameInput.value = "";
            }
        });

        renderAccountsRealtime();
    </script>
</body>
</html>
